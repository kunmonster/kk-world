<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>buycar</title>
    <style>
        #top {
            position: fixed;
            font-size: normal;
            color: black;
            top:0;
        }
    </style>
</head>


<body>
    <div style="position:fixed;margin-top:40%;float:right;">
        <!--导航栏-->
        <button style="width:48px;height:48px;background:url('../image/回到顶部\ .svg');border-style:none;"
            id="returnTop"></button>
        <table width="48px" height="48px" style="display:block; border:2px black solid;">
            <tr>
                <td>回到顶部</td>
            </tr>

        </table>
 
    </div>
 
      

        <div style="position:absolute;width: 70%;margin-left:15%">
            <div style="margin-top: 2%;font-size:xx-large;font-weight:900;margin-left:15px;">
                购物车
            </div>
            <div style="margin-top: 4%;">
                <li
                    style="list-style-type:none;height:16px;float:left;font-size:x-large;font-weight:bold;line-height: 1.1;text-align:center;">
                    <a href="#" style="TEXT-DECORATION:none;"><em
                            style="font-style: normal;color:red;margin-right:20px;padding-left:15px;">全部商品</em></a>
                    <span style="display:inline-block;width:2px;height:18px;background:gray;margin-right:20px"></span>
                    <a href="bookStore.html" style="TEXT-DECORATION:none;">特价商品</a>
                </li>
            </div>
            <br />
            <hr style="height:2px;margin-top:1%;background:gray;">
            <div>
                <li style="list-style-type:none;margin-left:15px;display:inline-block;width:100%">
                    <span><input type="checkbox" id="selectAll" onclick=selectAll()>全选<span>
                            <span style="padding: 20%;">商品信息</span>
                            <span style="padding-right:10%;">单价</span>
                            <span style="padding-right: 10%;">数量</span>
                            <span>金额</span>
                </li>
            </div>

            <form>
                <div style="margin-top: 5%;display:flex;background-color:snow;" id="maincar">

                    <!--购物车-->
                    <div style="margin-left:40%;text-align:center;" id="kong">
                        <p style="font-size:xx-large;text-align:center;">您的购物车为空!</p>
                        <a href="../page/bookstorecp.html"
                            style="TEXT-DECORATION:none;font-size:large;color:blue">马上选购!</a>
                    </div>
                    <div id="books" style="display:inline;" id="main">
                    </div>

                </div>
                <div style="position:relative;margin-top:5%;width:100%;height:60px;background-color:tomato">

                    <div style="display:inline-block;font-size:xx-large;margin-top:1%;"><span>合计:</span>
                        <span id="heji"></span>

                    </div>
                    <button
                        style="float:right;width:100px;height:60px;background-color:aliceblue;font-size:large;">立即结算</button>
                    <button style="float:right;width:100px;height:60px;background-color:aliceblue;font-size:large;"><a
                            href="../page/bookstorecp.html" style="TEXT-DECORATION:none;">继续选购</a></button>

                </div>
                <script>
                    function addnum(Element) {
                        var id = Element.id;
                        var num = localStorage.id;
                        if (Element.name == "less") {
                            localStorage[id]--;
                            var value = localStorage[id];
                            document.getElementById(id + "num").innerHTML = value;

                        }
                        if (Element.name == "more") {
                            localStorage[id]++;
                            var valueup = localStorage[id];
                            document.getElementById(id + "num").innerHTML = valueup;
                        }
                    }
                    var kong = document.getElementById("kong");
                    var books = document.getElementById("books");


                    function showBook() {
                        var havaView = []; //将已经访问过的加入该数组
                        if (localStorage.sum > 0) {
                            for (var i = 0; i < localStorage.length; i++) {
                                if (localStorage.key(i) != "sum" && localStorage[localStorage.key(i)] > 0) {
                                    //将sum键排除
                                    if (havaView.indexOf(localStorage.key(i)) == -1) {
                                        var name = localStorage.key(i);
                                        var number = localStorage.name;
                                        var oneprice = sessionStorage.getItem(name);
                                        var box = document.createElement("li");

                                        havaView.push(name);
                                        box.style.listStyleType = "none";



                                        //创建单选框
                                        var span1 = document.createElement("span");
                                        span1.style.position = "absolute";
                                        span1.style.marginRight = "20%";
                                        span1.style.marginTop = "6%";
                                        span1.style.width = "10px";
                                        span1.style.marginLeft = "15px";
                                        var input = document.createElement("input");
                                        input.type = "checkbox";
                                        input.id = name + "checkbox";
                                        input.name = name;
                                        input.className = "checkbox";
                                        span1.appendChild(input);

                                        //创建图片信息
                                        var span2 = document.createElement("span");
                                        var img = document.createElement("img");

                                        var address = "../image/" + name + ".jpg";
                                        img.src = address;
                                        img.style.width = "30%"
                                        span2.appendChild(img);
                                        span2.style.marginLeft = "13%";
                                        span2.style.marginTop = "10%";

                                        //加入书名信息
                                        var span3 = document.createElement("span");
                                        span3.style.position = "absolute";
                                        span3.style.marginTop = "6%";
                                        span3.style.marginLeft = "8%";
                                        span3.innerHTML = name;

                                        //单价
                                        var span4 = document.createElement("span");
                                        span4.style.position = "absolute";
                                        span4.style.marginLeft = "36%";
                                        span4.style.marginTop = "6%";
                                        span4.innerHTML = oneprice;


                                        //数量按钮

                                        var bt1 = document.createElement("button");
                                        var bt2 = document.createElement("button");

                                        bt1.type = "button";
                                        bt2.type = "button";
                                        bt1.id = name;
                                        bt2.id = name;
                                        bt1.name = "less";
                                        bt2.name = "more";
                                        bt1.style.textAlign = "center";
                                        bt2.style.textAlign = "center";


                                        bt1.textContent = "-";
                                        bt2.textContent = "+";
                                        bt1.className = "bnt";
                                        bt2.className = "bnt";




                                        var inputnum = document.createElement("input");
                                        inputnum.type="text";
                                        inputnum.id = name + "num";
                                        inputnum.className = "inputN";
                                        inputnum.name = name;


                                        inputnum.type = "text";
                                        inputnum.style.width = "14px";
                                        var Num = inputnum.value;

                                        inputnum.value = localStorage[name];


                                        //数量输入框标签
                                        var span5 = document.createElement("span");
                                        span5.style.position = "absolute";
                                        span5.style.marginTop = "6%";
                                        span5.style.marginLeft = "48%";
                                        span5.appendChild(bt1);
                                        span5.appendChild(inputnum);
                                        span5.appendChild(bt2);


                                        //小计标签
                                        var span6 = document.createElement("span");
                                        span6.className = "allprice";
                                        span6.id = name + "xiaoji";
                                        span6.name = name;
                                        span6.style.position = "absolute";
                                        span6.style.marginLeft = "64%";
                                        span6.style.marginTop = "6%";


                                        //删除按钮
                                        var span7 = document.createElement("span");
                                        span7.style.position = "absolute";
                                        span7.style.marginLeft = "75%";
                                        span7.style.marginTop = "6%";
                                        var del = document.createElement("button");
                                        del.type = "button";
                                        del.name = name;
                                        del.className = "delbtn";
                                        del.innerHTML = "删除";
                                        del.id = name + "del";

                                        span7.appendChild(del);


                                        //将动态添加的标签加入父元素
                                        box.appendChild(span1);
                                        box.appendChild(span2);
                                        box.appendChild(span3);
                                        box.appendChild(span4);
                                        box.appendChild(span5);
                                        box.appendChild(span6);
                                        box.appendChild(span7);
                                        books.appendChild(box);

                                    } else {
                                        continue;
                                    }

                                } else {
                                    continue;
                                }
                            }
                        }


                    }



                    window.onload = function () {
                        
                        var btn = document.getElementById("returnTop");
        
                        var timer = null;
        
                        var istop = true;
        
                        window.onscroll = function () {
        
                            if (!istop) {
                                clearInterval(timer);
                            }
                            istop = false;
                        }        
                        btn.onclick = function () {
                            //按钮点击事件
                            timer = setInterval(function () {
        
                                var dtop = document.documentElement.scrollTop;
        
                                var speed = Math.floor(-dtop / 5);
        
                                document.documentElement.scrollTop = dtop + speed;
                                istop = true;
        
                                if (dtop == 0) {
                                    clearInterval(timer);
                                }
        
                            }, 30)
                        }
                    
                        sessionStorage.setItem("c++ Primer plus", 25.00);
                        sessionStorage.setItem("Linux", 65.00);
                        sessionStorage.setItem("java核心卷1", 110.00);
                        sessionStorage.setItem("HTML", 80.00);
                        sessionStorage.setItem("人体简史", 20.00);
                        sessionStorage.setItem("乔布斯传", 40.00);
                        sessionStorage.setItem("倾城之恋", 25.99);
                        sessionStorage.setItem("如何才能不焦虑", 29.99);
                        sessionStorage.setItem("知更鸟", 32.00);
                        sessionStorage.setItem("时间简史", 128.00);
                        sessionStorage.setItem("山海经", 28.00);
                        sessionStorage.setItem("大话设计模式", 56.00);
                        if ((localStorage.sum == 0) || (localStorage.getItem("sum") == null)) {
                            kong.style.display = "block";
                            books.style.display = "none";
                        } else {
                            kong.style.display = "none";
                            books.style.display = "inline";
                        }
                        showBook();

                        var heading = document.getElementsByClassName("bnt");
                        if (heading.length > 0) {
                            for (var i = 0; i < heading.length; i++) {
                                heading[i].onclick = function () {
                                    var type = this.name;
                                    var ID = this.id;
                                    if (type == "less") {
                                        localStorage[ID]--;
                                        localStorage["sum"]--;
                                        document.getElementById(ID).innerHTML = localStorage.ID;
                                    }
                                    if (type == "more") {
                                        localStorage[ID]++;
                                        localStorage["sum"]++;
                                        document.getElementById(ID).innerHTML = localStorage.ID;
                                    }
                                    window.location.reload();
                                }
                            }
                        }


                     
                        //小计
                        var littleall = document.getElementsByClassName("allprice");
                        for (var i = 0; i < littleall.length; i++) {
                            var Id = littleall[i].name + "num";
                            var number = parseInt(document.getElementById(Id).value);
                            var oneprice = parseInt(sessionStorage[littleall[i].name]);
                            var allnumber = number * oneprice;
                            littleall[i].innerHTML = parseFloat(allnumber);
                        }

                        //根据复选框的内容来进行合计的统计
                        function heji() {
                            var showheji = document.getElementById("heji");
                            var inputcheck = document.getElementsByClassName("checkbox");
                            var money = 0;

                            for (var i = 0; i < inputcheck.length; i++) {
                                if (inputcheck[i].checked == true) {
                                    var ID = inputcheck[i].name + "xiaoji";
                                    var xiaoji = parseInt(document.getElementById(ID).innerHTML);
                                    money += xiaoji;
                                } else {
                                    continue;
                                }
                            }
                            document.getElementById("heji").innerHTML = money;
                        }


                        var inputcheck = document.getElementsByClassName("checkbox");
                        var selectall = document.getElementById("selectAll");
                        inputcheck.onchange = function () {
                            for (var i = 0; i < inputcheck.length; i++) {
                                inputcheck[i].checked = this.checked;
                            }
                        };
                        for (var i = 0; i < inputcheck.length; i++) {
                            inputcheck[i].onchange = function () {
                                Isselect();
                                heji();
                            };
                        }
                        var Isselect = function () {
                            var count = 0;
                            for (var j = 0; j < inputcheck.length; j++) {
                                if (inputcheck[j].checked == true) {
                                    count++;
                                }
                                if (count == inputcheck.length) {
                                    selectall.checked = true;
                                } else {
                                    selectall.checked = false;
                                }
                            }
                        }
                        selectall.onchange = function () {
                            var count = 0;
                            if (this.checked == true) {

                                for (var j = 0; j < inputcheck.length; j++) {
                                    if (inputcheck[j].checked == true) {
                                        count++;
                                    } else {
                                        inputcheck[j].checked = true;
                                        count++;
                                    }
                                }

                            } else {
                                for (var j = 0; j < inputcheck.length; j++) {
                                    if (inputcheck[j].checked == true) {
                                        count--;
                                        inputcheck[j].checked = false;
                                    } else {
                                        continue;
                                    }
                                }

                            }
                            heji();
                        }
                        //删除按钮
                        var alldel = document.getElementsByClassName("delbtn");
                        for (var m = 0; m < alldel.length; m++) {
                            alldel[m].onclick = function () {
                                var targ = this.name;
                                var reduce = Number(localStorage[targ]);
                                var orgin = Number(localStorage["sum"]);
                                localStorage[targ] = 0;
                                var finalvalue = orgin - reduce;
                                localStorage["sum"] = finalvalue;

                                window.location.reload();
                            }
                        }

                           //将输入框的值改变同步到本地储存API中#注意改变sum的值
                           var newnum = document.getElementsByClassName("inputN");
                           for (var i = 0; i < newnum.length; i++) {
                               newnum[i].onchange= function () {
                                   var thisname = this.name;
                                   var Id = this.name+"num";
                                   var newvalue = Number(document.getElementById(Id).value); //将获取到的值给newvalue
                                   var oldvalue = Number(localStorage[thisname]);
                                   localStorage[thisname] = newvalue;
                                   var varible = newvalue - oldvalue;
                                   var sumValue = 0;
                                   sumValue = Number(localStorage["sum"]);
                                   sumValue = sumValue + varible;
                                   localStorage["sum"] = sumValue;
                                   window.location.reload();
                                   
                               }
                           }
   

                    }
                </script>
            </form>

        </div>
        <div id="top">
            <!--顶部-->
            <table width="100%" style="position:fixed;">
                <tr>
                    <td width="79%" style="background-color:aliceblue;">
                        欢迎光临本书城&nbsp;&nbsp;&nbsp;祝您购物愉快！
                    </td>
                    <td style="background-color: aliceblue;">
                        <a style="background-color: aliceblue;" href="../page/bucar1.1.html"><img
                                src="../image/购物车空.png" width="16px" height="16px">购物车</a>|
                        <a style="background-color:aliceblue" href="#">帮助中心</a>|
                        <a style="background-color: aliceblue;" href="myuser.html">新用户注册</a>|
                        <a style="background-color:aliceblue" href="../page/login.html">我的账户<img
                                src="../image/账户头像.png " width="16px" height="17px"></a>
                    </td>
                </tr>
            </table>
        </div>
   
</body>

</html>