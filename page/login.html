<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>login</title>
</head>
<style>
    #all {
        text-align: center;
        width: 350px;
        height: 550px;
        margin-left: 40%;
        margin-top: 5%;
        background-color: aliceblue
    }

    #headpict {
        position: relative;
        padding-top: 10%;
    }

    #usernmaes {
        position: relative;
        margin-top: 20%;
    }

    #canvas {
        width: 100px;
        height: 40px;
        background-color: antiquewhite;
        border: 2px;
    }
</style>

<body>
    <div id="all">
        <div id="headpict">
            <img src="../image/头像.png" width="20%">
        </div>
        <form action="#" method="POST">
            <div id="usernmaes">
                <!--用户名-->
                <label for="username">用户名:</label>
                <input type="text" id="username" name="username" autofocus>
            </div>
            <div style="position:relative;margin-top:5%;">
                <!--密码-->
                <label for="pwd1">密&nbsp;&nbsp;&nbsp;码:</label>
                <input type="password" id="pwd1" name="pwd1" autofocus required>

            </div>
            <a style="position:absolute;margin-right:30px;color:cornflowerblue;TEXT-DECORATION:none;" href="#">忘记密码?点这里!</a>
            <div style="position:relative;float:left;margin-left:2px;margin-top:10%;">
                <!--验证码-->
                <label for="check">验证码:</label>
                <input type="text" id="check" name="check" style="width:15%" maxlength="6" autofocus>
            </div>
            <div style="position:relative;margin-top:8%;float:right;padding-right:26px">
                <canvas id="canvas" onclick="recreate()"></canvas>
                <script>
                    window.onload = function () {
                        /*在窗口加载时启动*/
                        CreateCode(6);
                    }

                    function getCTX() {
                        /*获得canvas*/
                        var ctx = document.getElementById("canvas").getContext("2d");
                        return ctx;
                    }

                    function getRandomColor() {
                        /*随机生成颜色*/
                        return '#' + Math.floor(Math.random() * 16777215).toString(16);
                    };

                    function CreateCode(length) {
                        code = ""; /*验证码*/
                        var choice = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h',
                            'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y',
                            'z', 'A',
                            'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N',
                            'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z');
                        var length1 = parseInt(length);
                        for (var i = 0; i < length1; i++) {
                            var index = Math.floor(Math.random() * 52);
                            code += choice[index]; /*随机生成验证码*/
                        }
                        if (code.length != 0) {
                            /*显示验证码*/
                            var ctx = getCTX();
                            var deg = Math.random() * 30 * Math.PI / 180;
                            ctx.fillStyle = getRandomColor();
                            ctx.font = "bold 52px serif";
                            ctx.rotate(deg); /*使图形偏转角度*/
                            ctx.fillText(code, 40, 65);
                            ctx.rotate(-deg);
                            drawpoint(80);
                            drawLine(20);
                        }
                    }

                    function drawpoint(num) {
                        /*随机生成干扰点*/
                        var nums = parseInt(num);
                        var ctx = getCTX();
                        ctx.beginPath();
                        for (var i = 0; i < nums; i++) {
                            ctx.strokeStyle = getRandomColor();
                            var x = Math.random() * 300;
                            var y = Math.random() * 300;
                            ctx.moveTo(x, y);
                            ctx.lineTo(x + 1, y + 1)
                            ctx.stroke();
                        }
                    }

                    function recreate() {
                        var ctx = getCTX();
                        ctx.clearRect(0, 0, 400, 400);
                        CreateCode(6);
                    }

                    function drawLine(num) {
                        /*随机生成干扰直线*/
                        var nums = parseInt(num);
                        var ctx = getCTX();
                        ctx.beginPath();
                        for (var i = 0; i < nums; i++) {
                            ctx.strokeStyle = getRandomColor();
                            var x = Math.random() * 300;
                            var y = Math.random() * 300;
                            ctx.moveTo(x, y);
                            ctx.lineTo(x + Math.random() * 50, y + Math.random() * 50)
                            ctx.stroke();
                        }
                    }

                    function checkuser() {
                        var user = document.getElementById("username").value;
                        var pas1 = document.getElementById("pwd1").value;
                        if (localStorage.getItem(user)) {
                            if (pas1 == localStorage.getItem(user)) {
                                return true;
                            } else
                                return 0;
                        }
                        return -1;
                    }

                    function cmp() {
                        //检验输入的验证码是否正确
                        var value = document.getElementById("check").value;
                        if(value.length == 6){
                        if (value.toUpperCase() != code.toUpperCase()) {
                            alert("验证码错误");
                        } 
                        else {
                            var a = checkuser();
                            if (a == -1) {
                                alert("不存在此用户");
                            } else if (a == 0) {
                                alert("密码输入错误");
                            } else {
                                alert("登录成功");
                            }
                        }
                    }
                    else{
                        alert("验证码格式错误!请重新输入!")
                    }
                }
                </script>

            </div>
            
            <div style="margin-top:40%;">
                <!--登录按钮-->
                <button type="submit" value="登录" onclick="cmp()">登录</button>
                <button type="reset" value="重置">重置</button>
            </div>

        </form>
    </div>
</body>

</html>